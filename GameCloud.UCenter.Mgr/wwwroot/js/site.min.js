var $enums=$enums||{},$pluginApp;(function(n){n.items=[];n.find=function(t,i){var r=n.items.find(function(n){return n.name==t});if(typeof i=="undefined")return r;if(!r)return i;return r.items.find(function(n){return n.value===i||n.name===i})}})($enums||($enums={}));Date.today=function(){let n=new Date;return n.setHours(0,0,0,0),n};Date.prototype.add=function(n,t){if(t=="days")return this.setDate(this.getDate()+n),this;console.log("not support period.")};Date.yesterday=function(){var n=Date.today();return n.add(-1,"days"),n};$groupCache={};$pluginApp=angular.module("pluginApp",["ui.bootstrap","chart.js","ngRoute","gc.bootstrap.modal"]).filter("enums",function(){return function(n,t){var i=$enums.find(t,n);return i?i.displayName:n}}).filter("group",function(){return function(n,t){var i,r,f,u;if(!n)return null;if(i=[],angular.forEach(n,function(n){i.push(n.name)}),i=i.join("-")+"-"+t,$groupCache[i])return $groupCache[i];if(r=[],f=[],n.length<t)r=[n];else for(u=0;u<n.length;u++)u%t==0&&(f=[],r.push(f)),f.push(n[u]);return $groupCache[i]=r,r}}).service("pluginService",["$http","$location",function(){var n=function(n,t){for(var i=n.length-1;i>=0;i--)if(n[i].name==t)return n[i];return n[0]},t=[],i;this.plugin=$plugin;this.registerObserverCallback=function(n){t.push(n)};i=function(){angular.forEach(t,function(n){n()})};this.setCurrent=function(t){var i=/\/category\/([^\/]*)(\/item\/([^\/]*))?/.exec(t),u,r;i!=null?(u=i[1],r=i[3],this.category=n(this.plugin.categories,u),this.item=this.category&&r?n(this.category.items,r):null):(this.category=null,this.item=null)};this.init=function(n){this.setCurrent(n);i()}}]).controller("baseController",["$scope","$http","$location","$templateCache","pluginService",function(n,t,i,r,u){function f(){n.plugins=u.plugins;n.plugin=u.plugin;n.category=u.category;n.item=u.item}n.$enums=$enums;f();u.registerObserverCallback(f)}]).controller("navController",["$scope","$http","$templateCache","$controller","pluginService",function(n,t,i,r,u){r("baseController",{$scope:n});n.plugins=u.plugins;n.plugin=u.plugin;n.setCategory=function(n){u.category=n};n.setItem=function(n){u.item=n}}]).controller("pluginController",["$scope","$http","$templateCache","$controller","pluginService",function(n,t,i,r){r("baseController",{$scope:n})}]).controller("categoryController",["$scope","$http","$templateCache","$controller","pluginService",function(n,t,i,r){r("baseController",{$scope:n})}]).controller("apiController",["$scope","$http","$templateCache","$controller","pluginService",function(n,t,i,r){var u,f;r("baseController",{$scope:n});u={fetch:"\u6b63\u5728\u52a0\u8f7d",update:"\u6b63\u5728\u66f4\u65b0","delete":"\u6b63\u5728\u5220\u9664",done:null};n.params={};n.beforeFetch=function(){};f=function(i,r){var e,f;n.code=null;n.response=null;e=[];for(f in n.params)n.params[f]&&e.push(f+"="+n.params[f]);n.error=null;t.post("/api/plugins",{pluginName:n.plugin.name,categoryName:n.category?n.category.name:null,itemName:n.item.name,method:i,content:n.params},{responseType:"json",timeout:1e4}).then(function(t){n.loadingText=u.done;n.status=t.status;n.data=t.data;console.log(t);r&&r(!0,t)},function(t){n.loadingText=u.done;console.log(t);n.error={status:t.status,message:t.data||(t.status=="-1"?"\u8bf7\u6c42\u8d85\u65f6\uff0c\u670d\u52a1\u5668\u6ca1\u6709\u5728\u6709\u6548\u65f6\u95f4\u5185\u505a\u51fa\u76f8\u5e94":"\u53d1\u751f\u672a\u77e5\u9519\u8bef")};r&&r(!1,t)})};n._hideError=function(){n.error=null};n._fetch=function(t){n.loadingText=u.fetch;f("Read",t)};n._update=function(t){n.loadingText=u.update;f("Update",t)};n._delete=function(t){n.loadingText=u.delete;f("Delete",t)};n._sync=function(t){var i,r;n.item&&(i=n.item.refreshInterval||n.plugin.refreshInterval,i>0?(r=function(u,f){t&&t(u,f);setTimeout(function(){n._fetch(r)},i)},n._fetch(r)):n._fetch(t))}}]).controller("pluginsController",["$scope","$http","$templateCache","$controller","pluginService",function(n,t,i,r){r("apiController",{$scope:n})}]).controller("tableController",["$scope","$http","$templateCache","$controller","pluginService",function(n,t,i,r){r("apiController",{$scope:n});n.maxShowPages=7;n.params.pageSize=10;n.pageSizeList=[5,10,20,50];n.beforeFetch=function(){};n.onPageChange=function(){n._fetch()};n.onPageSizeChange=function(t){n.params.pageSize=t;n._fetch()};n.updateModel=function(t,i){n.method=t;n.url=i};n.open=function(t){n.raw=t;n.showModal=!0};n.save=function(){n.params.raw=JSON.stringify(n.raw);n._update();n.showModal=!1};n.delete=function(t){n.params.raw=JSON.stringify(t);n._delete();n.showModel=!1};n.cancel=function(){n.showModal=!1};n._sync()}]).controller("formController",["$scope","$http","$templateCache","$controller","pluginService",function(n,t,i,r){r("apiController",{$scope:n});n.updateData=function(){n.params.data=JSON.stringify(n.data);n._update()};n._fetch()}]).controller("chartController",["$scope","$http","$templateCache","$controller","pluginService",function(n,t,i,r){r("apiController",{$scope:n});n._sync()}]).config(["$routeProvider",function(n){$plugin&&$plugin.categories&&$plugin.categories.forEach(function(t){n.when("/category/"+t.name,{templateUrl:"/plugins/_templates/views/category.html",controller:"categoryController"});t.items&&t.items.forEach(function(i){n.when("/category/"+t.name+"/item/"+i.name,{templateUrl:"/plugins/_templates/views/"+i.type+".html",controller:i.controller})})});n.otherwise({templateUrl:"/plugins/_templates/views/plugin.html",controller:"pluginController"})}]).run(["$rootScope","$location","$http","pluginService",function(n,t,i,r){n.$on("$routeChangeStart",function(){r.init(t.path())});r.init(t.path())}]);